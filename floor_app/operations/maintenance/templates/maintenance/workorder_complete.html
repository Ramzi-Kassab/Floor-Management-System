{% extends "base.html" %}

{% block title %}Complete Work Order{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="mb-4">
        <h1 class="h3">Complete Work Order</h1>
        <p class="text-muted">{{ work_order.work_order_number }} - {{ work_order.title }}</p>
    </div>

    <form method="post">
        {% csrf_token %}

        <div class="row">
            <div class="col-lg-8">
                <!-- Timing -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Actual Timing</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Actual Start *</label>
                                {{ form.actual_start }}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Actual End *</label>
                                {{ form.actual_end }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Work Details -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Work Details</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Work Performed *</label>
                            {{ form.work_performed }}
                            <small class="text-muted">Describe in detail what was done</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Solution Summary</label>
                            {{ form.solution_summary }}
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Recommendations</label>
                            {{ form.recommendations }}
                            <small class="text-muted">Any follow-up actions or preventive measures</small>
                        </div>
                    </div>
                </div>

                <!-- Root Cause -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Root Cause Analysis</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Root Cause Category</label>
                            {{ form.root_cause_category }}
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Root Cause Detail</label>
                            {{ form.root_cause_detail }}
                        </div>
                    </div>
                </div>

                <!-- Costs -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Cost Summary</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Labor Hours</label>
                                {{ form.labor_hours }}
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Labor Cost</label>
                                {{ form.labor_cost }}
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Parts Cost</label>
                                {{ form.parts_cost }}
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">External Cost</label>
                                {{ form.external_cost }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <!-- Summary -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h6 class="mb-0">Work Order Summary</h6>
                    </div>
                    <div class="card-body">
                        <dl class="row mb-0">
                            <dt class="col-6">Asset</dt>
                            <dd class="col-6">{{ work_order.asset.asset_code }}</dd>

                            <dt class="col-6">Type</dt>
                            <dd class="col-6">{{ work_order.get_work_order_type_display }}</dd>

                            <dt class="col-6">Priority</dt>
                            <dd class="col-6">
                                <span class="badge bg-{% if work_order.priority == 'CRITICAL' %}danger{% else %}warning{% endif %}">
                                    {{ work_order.priority }}
                                </span>
                            </dd>

                            <dt class="col-6">Assigned To</dt>
                            <dd class="col-6">{{ work_order.assigned_to|default:"-" }}</dd>

                            <dt class="col-6">Planned Start</dt>
                            <dd class="col-6">{{ work_order.planned_start|date:"Y-m-d H:i"|default:"-" }}</dd>

                            <dt class="col-6">Planned End</dt>
                            <dd class="col-6">{{ work_order.planned_end|date:"Y-m-d H:i"|default:"-" }}</dd>
                        </dl>
                    </div>
                </div>

                <!-- Actions -->
                <div class="card">
                    <div class="card-body">
                        <button type="submit" class="btn btn-success w-100 mb-2">
                            <i class="fas fa-check"></i> Complete Work Order
                        </button>
                        <a href="{% url 'maintenance:workorder_detail' work_order.work_order_number %}" class="btn btn-outline-secondary w-100">
                            Cancel
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<style>
    .form-control, .form-select {
        padding: 0.5rem 0.75rem;
    }
</style>
{% endblock %}
