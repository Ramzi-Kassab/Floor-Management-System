{% extends "base.html" %}

{% block title %}{{ customer.name }} - Customer Detail{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-1">{{ customer.name }}</h1>
            <p class="text-muted mb-0">{{ customer.customer_code }} - {{ customer.get_customer_type_display }}</p>
        </div>
        <div>
            <a href="{% url 'sales:customer_update' customer.pk %}" class="btn btn-primary">
                <i class="bi bi-pencil me-1"></i> Edit
            </a>
            <a href="{% url 'sales:customer_list' %}" class="btn btn-outline-secondary">
                Back to List
            </a>
        </div>
    </div>

    <div class="row g-4">
        <!-- Customer Info -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">Customer Information</div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-5">Status</dt>
                        <dd class="col-sm-7">
                            <span class="badge {% if customer.account_status == 'ACTIVE' %}bg-success{% else %}bg-secondary{% endif %}">
                                {{ customer.get_account_status_display }}
                            </span>
                        </dd>
                        <dt class="col-sm-5">Type</dt>
                        <dd class="col-sm-7">{{ customer.get_customer_type_display }}</dd>
                        <dt class="col-sm-5">Region</dt>
                        <dd class="col-sm-7">{{ customer.region|default:"-" }}</dd>
                        <dt class="col-sm-5">Country</dt>
                        <dd class="col-sm-7">{{ customer.country|default:"-" }}</dd>
                        <dt class="col-sm-5">Contact</dt>
                        <dd class="col-sm-7">{{ customer.primary_contact_name|default:"-" }}</dd>
                        <dt class="col-sm-5">Email</dt>
                        <dd class="col-sm-7">{{ customer.primary_contact_email|default:"-" }}</dd>
                        <dt class="col-sm-5">Phone</dt>
                        <dd class="col-sm-7">{{ customer.primary_contact_phone|default:"-" }}</dd>
                        <dt class="col-sm-5">Payment Terms</dt>
                        <dd class="col-sm-7">{{ customer.payment_terms_days }} days</dd>
                        <dt class="col-sm-5">Credit Limit</dt>
                        <dd class="col-sm-7">${{ customer.credit_limit|floatformat:2 }}</dd>
                    </dl>
                </div>
            </div>
        </div>

        <!-- Rigs -->
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>Rigs</span>
                    <span class="badge bg-primary">{{ rigs.count }}</span>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for rig in rigs %}
                            <tr>
                                <td><a href="{% url 'sales:rig_detail' rig.pk %}">{{ rig.rig_code }}</a></td>
                                <td>{{ rig.name }}</td>
                                <td>{{ rig.get_rig_type_display }}</td>
                                <td><span class="badge bg-info">{{ rig.get_status_display }}</span></td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center text-muted">No rigs</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Wells -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>Wells</span>
                    <span class="badge bg-primary">{{ wells.count }}</span>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Field</th>
                                <th>Type</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for well in wells %}
                            <tr>
                                <td><a href="{% url 'sales:well_detail' well.pk %}">{{ well.well_name }}</a></td>
                                <td>{{ well.field_name }}</td>
                                <td>{{ well.get_well_type_display }}</td>
                                <td><span class="badge bg-info">{{ well.get_status_display }}</span></td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center text-muted">No wells</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="row g-4 mt-2">
        <!-- Recent Orders -->
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">Recent Sales Orders</div>
                <div class="table-responsive">
                    <table class="table table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Order #</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in orders %}
                            <tr>
                                <td><a href="{% url 'sales:order_detail' order.pk %}">{{ order.order_number }}</a></td>
                                <td>{{ order.order_date|date:"M d, Y" }}</td>
                                <td><span class="badge bg-secondary">{{ order.get_status_display }}</span></td>
                                <td>${{ order.total_value|floatformat:0 }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center text-muted">No orders</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Recent Drilling Runs -->
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">Recent Drilling Runs</div>
                <div class="table-responsive">
                    <table class="table table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Run #</th>
                                <th>Bit S/N</th>
                                <th>Footage</th>
                                <th>ROP</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for run in runs %}
                            <tr>
                                <td><a href="{% url 'sales:drilling_detail' run.pk %}">{{ run.run_number }}</a></td>
                                <td>{{ run.bit_serial_number }}</td>
                                <td>{{ run.footage_drilled|floatformat:0|default:"-" }} ft</td>
                                <td>{{ run.avg_rop|floatformat:1|default:"-" }} ft/hr</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center text-muted">No runs</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Lifecycle Events -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">Recent Bit Lifecycle Events</div>
                <div class="table-responsive">
                    <table class="table table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Bit Serial</th>
                                <th>Event Type</th>
                                <th>Location</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for event in lifecycle_events %}
                            <tr>
                                <td>{{ event.event_datetime|date:"M d, Y H:i" }}</td>
                                <td>
                                    <a href="{% url 'sales:lifecycle_timeline' %}?bit_serial={{ event.bit_serial_number }}">
                                        {{ event.bit_serial_number }}
                                    </a>
                                </td>
                                <td>{{ event.get_event_type_display }}</td>
                                <td>{{ event.location_description|default:"-" }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center text-muted">No events</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
