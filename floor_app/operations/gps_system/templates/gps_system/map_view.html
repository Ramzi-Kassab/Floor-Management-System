{% extends "base.html" %}
{% load static %}

{% block title %}GPS Map View{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<style>
    #fullMap { height: calc(100vh - 200px); border-radius: 12px; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-white">
            <h5 class="mb-0"><i class="bi bi-map-fill me-2"></i>GPS Map View</h5>
        </div>
        <div class="card-body p-0">
            <div id="fullMap"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
var map = L.map('fullMap').setView([{{ lat|default:"24.7136" }}, {{ lng|default:"46.6753" }}], 13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap contributors'
}).addTo(map);

// Add zones
{% for zone in zones %}
L.circle([{{ zone.latitude }}, {{ zone.longitude }}], {
    color: '#0d6efd',
    fillColor: '#0d6efd',
    fillOpacity: 0.2,
    radius: {{ zone.radius }}
}).addTo(map).bindPopup('<strong>{{ zone.name }}</strong><br>Radius: {{ zone.radius }}m');
{% endfor %}

// Add marker if specific location
{% if lat and lng %}
L.marker([{{ lat }}, {{ lng }}]).addTo(map).bindPopup('Verification Point').openPopup();
{% endif %}
</script>
{% endblock %}
