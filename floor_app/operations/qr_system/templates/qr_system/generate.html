{% extends "base.html" %}
{% load static %}

{% block title %}QR Code Generator{% endblock %}

{% block extra_css %}
<style>
    .qr-preview { max-width: 300px; margin: 2rem auto; padding: 2rem; background: white; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.1); }
    .qr-preview img { width: 100%; height: auto; }
    .integration-card { border-left: 4px solid #0d6efd; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <h2 class="mb-4"><i class="bi bi-qr-code me-2"></i>QR Code Generator</h2>

            <!-- Integration Examples -->
            <div class="alert alert-info mb-4">
                <h5><i class="bi bi-info-circle me-2"></i>QR Code Integration Across Systems</h5>
                <p class="mb-2">QR codes can be generated for:</p>
                <ul class="mb-0">
                    <li><strong>Device Tracking:</strong> Quick device registration and check-in</li>
                    <li><strong>GPS Verification:</strong> Location-based check-ins at physical sites</li>
                    <li><strong>Approvals:</strong> Quick approval/rejection via mobile scan</li>
                    <li><strong>Inventory:</strong> Asset and item tracking</li>
                    <li><strong>HR:</strong> Employee badges and attendance</li>
                    <li><strong>Notifications:</strong> Quick access to announcements</li>
                </ul>
            </div>

            <div class="row g-4">
                <div class="col-lg-6">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white">
                            <h5 class="mb-0">Generate New QR Code</h5>
                        </div>
                        <div class="card-body">
                            <form method="post" id="qrForm">
                                {% csrf_token %}
                                <div class="mb-3">
                                    <label class="form-label">QR Code Type</label>
                                    <select class="form-select" name="qr_type" id="qrType" onchange="updateFields()">
                                        <option value="device">Device Registration</option>
                                        <option value="location">GPS Location Check-In</option>
                                        <option value="approval">Approval Request</option>
                                        <option value="asset">Asset/Item</option>
                                        <option value="employee">Employee Badge</option>
                                        <option value="url">Custom URL</option>
                                    </select>
                                </div>

                                <div id="deviceFields" class="dynamic-fields">
                                    <div class="mb-3">
                                        <label class="form-label">Device ID</label>
                                        <input type="text" class="form-control" name="device_id">
                                    </div>
                                </div>

                                <div id="locationFields" class="dynamic-fields" style="display:none;">
                                    <div class="mb-3">
                                        <label class="form-label">GPS Zone</label>
                                        <select class="form-select" name="zone_id">
                                            {% for zone in gps_zones %}
                                            <option value="{{ zone.id }}">{{ zone.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Label</label>
                                    <input type="text" class="form-control" name="label" placeholder="Descriptive label">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Size</label>
                                    <select class="form-select" name="size">
                                        <option value="small">Small (200x200)</option>
                                        <option value="medium" selected>Medium (400x400)</option>
                                        <option value="large">Large (800x800)</option>
                                    </select>
                                </div>

                                <button type="submit" class="btn btn-primary btn-lg w-100">
                                    <i class="bi bi-qr-code me-2"></i>Generate QR Code
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white">
                            <h5 class="mb-0">Integration Examples</h5>
                        </div>
                        <div class="card-body">
                            <div class="integration-card card mb-3">
                                <div class="card-body">
                                    <h6><i class="bi bi-phone me-2"></i>Device Check-In</h6>
                                    <p class="small mb-0">Generate QR codes for employee devices. Scan to auto-register and check in at locations.</p>
                                </div>
                            </div>

                            <div class="integration-card card mb-3">
                                <div class="card-body">
                                    <h6><i class="bi bi-geo-alt me-2"></i>Location Verification</h6>
                                    <p class="small mb-0">Place QR codes at physical locations for GPS-verified check-ins and attendance tracking.</p>
                                </div>
                            </div>

                            <div class="integration-card card mb-3">
                                <div class="card-body">
                                    <h6><i class="bi bi-hand-thumbs-up me-2"></i>Quick Approvals</h6>
                                    <p class="small mb-0">Generate QR codes for approval requests. Scan to approve/reject from mobile device.</p>
                                </div>
                            </div>

                            <div class="integration-card card mb-3">
                                <div class="card-body">
                                    <h6><i class="bi bi-box me-2"></i>Asset Tracking</h6>
                                    <p class="small mb-0">Label assets with QR codes for instant access to details, maintenance history, and location.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview Area -->
            {% if qr_code %}
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-check-circle me-2"></i>QR Code Generated Successfully</h5>
                </div>
                <div class="card-body text-center">
                    <div class="qr-preview">
                        <img src="{{ qr_code.image_url }}" alt="QR Code">
                        <div class="mt-3">
                            <strong>{{ qr_code.label }}</strong><br>
                            <small class="text-muted">{{ qr_code.code }}</small>
                        </div>
                    </div>
                    <div class="d-flex gap-2 justify-content-center">
                        <a href="{{ qr_code.image_url }}" download class="btn btn-primary">
                            <i class="bi bi-download me-2"></i>Download
                        </a>
                        <button class="btn btn-outline-secondary" onclick="window.print()">
                            <i class="bi bi-printer me-2"></i>Print
                        </button>
                        <a href="{% url 'qr_system:generate' %}" class="btn btn-outline-primary">
                            <i class="bi bi-plus-circle me-2"></i>Generate Another
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function updateFields() {
    document.querySelectorAll('.dynamic-fields').forEach(el => el.style.display = 'none');
    const type = document.getElementById('qrType').value;
    const fieldMap = {
        'device': 'deviceFields',
        'location': 'locationFields'
    };
    if (fieldMap[type]) {
        document.getElementById(fieldMap[type]).style.display = 'block';
    }
}
</script>
{% endblock %}
