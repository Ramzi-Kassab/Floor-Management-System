# Generated by Django 5.2.6 on 2025-11-17 11:31

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('evaluation', '0001_initial'),
        ('hr', '0002_employeedocument_documentrenewal_employeetraining_and_more'),
        ('inventory', '0001_initial'),
        ('production', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.AddField(
            model_name='evaluationsession',
            name='batch_order',
            field=models.ForeignKey(blank=True, help_text='Associated batch order (if applicable)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='evaluation_sessions', to='production.batchorder'),
        ),
        migrations.AddField(
            model_name='evaluationsession',
            name='created_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_created', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='evaluationsession',
            name='evaluator',
            field=models.ForeignKey(help_text='Employee who performed the evaluation', on_delete=django.db.models.deletion.PROTECT, related_name='evaluations_conducted', to='hr.hremployee'),
        ),
        migrations.AddField(
            model_name='evaluationsession',
            name='job_card',
            field=models.ForeignKey(blank=True, help_text='Associated job card (if applicable)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='evaluation_sessions', to='production.jobcard'),
        ),
        migrations.AddField(
            model_name='evaluationsession',
            name='locked_by',
            field=models.ForeignKey(blank=True, help_text='User who locked the evaluation', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='evaluations_locked', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='evaluationsession',
            name='mat_revision',
            field=models.ForeignKey(help_text='MAT/design revision used as reference for this evaluation', on_delete=django.db.models.deletion.PROTECT, related_name='evaluation_sessions', to='inventory.bitdesignrevision'),
        ),
        migrations.AddField(
            model_name='evaluationsession',
            name='reviewing_engineer',
            field=models.ForeignKey(blank=True, help_text='Engineer who reviewed/approved the evaluation', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='evaluations_reviewed', to='hr.hremployee'),
        ),
        migrations.AddField(
            model_name='evaluationsession',
            name='serial_unit',
            field=models.ForeignKey(help_text='The physical bit being evaluated', on_delete=django.db.models.deletion.PROTECT, related_name='evaluation_sessions', to='inventory.serialunit'),
        ),
        migrations.AddField(
            model_name='evaluationsession',
            name='updated_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(app_label)s_%(class)s_updated', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='evaluationchangelog',
            name='evaluation_session',
            field=models.ForeignKey(help_text='Evaluation session being tracked', on_delete=django.db.models.deletion.CASCADE, related_name='change_logs', to='evaluation.evaluationsession'),
        ),
        migrations.AddField(
            model_name='evaluationcell',
            name='evaluation_session',
            field=models.ForeignKey(help_text='Parent evaluation session', on_delete=django.db.models.deletion.CASCADE, related_name='cells', to='evaluation.evaluationsession'),
        ),
        migrations.AddField(
            model_name='ndtinspection',
            name='evaluation_session',
            field=models.ForeignKey(help_text='Parent evaluation session', on_delete=django.db.models.deletion.CASCADE, related_name='ndt_inspections', to='evaluation.evaluationsession'),
        ),
        migrations.AddField(
            model_name='ndtinspection',
            name='inspector',
            field=models.ForeignKey(help_text='Certified inspector who performed the test', on_delete=django.db.models.deletion.PROTECT, related_name='ndt_inspections_conducted', to='hr.hremployee'),
        ),
        migrations.AddField(
            model_name='evaluationchangelog',
            name='ndt_inspection',
            field=models.ForeignKey(blank=True, help_text='NDT inspection that was changed (if applicable)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='change_logs', to='evaluation.ndtinspection'),
        ),
        migrations.AddField(
            model_name='requirementinstance',
            name='evaluation_session',
            field=models.ForeignKey(help_text='Evaluation session this requirement applies to', on_delete=django.db.models.deletion.CASCADE, related_name='requirement_instances', to='evaluation.evaluationsession'),
        ),
        migrations.AddField(
            model_name='requirementinstance',
            name='satisfied_by',
            field=models.ForeignKey(blank=True, help_text='User who satisfied/verified the requirement', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='requirements_satisfied', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='requirementinstance',
            name='waived_by',
            field=models.ForeignKey(blank=True, help_text='User who waived the requirement', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='requirements_waived', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='requirementinstance',
            name='waiver_approved_by',
            field=models.ForeignKey(blank=True, help_text='Authority who approved the waiver', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='requirement_waiver_approvals', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddIndex(
            model_name='requirementtemplate',
            index=models.Index(fields=['stage', 'is_mandatory', 'is_active'], name='ix_req_template_stage'),
        ),
        migrations.AddIndex(
            model_name='requirementtemplate',
            index=models.Index(fields=['requirement_type', 'is_active'], name='ix_req_template_type'),
        ),
        migrations.AddIndex(
            model_name='requirementtemplate',
            index=models.Index(fields=['code'], name='ix_req_template_code'),
        ),
        migrations.AddField(
            model_name='requirementinstance',
            name='template',
            field=models.ForeignKey(help_text='Requirement template', on_delete=django.db.models.deletion.PROTECT, related_name='instances', to='evaluation.requirementtemplate'),
        ),
        migrations.AddField(
            model_name='technicalinstructioninstance',
            name='acknowledged_by',
            field=models.ForeignKey(blank=True, help_text='User who acknowledged the instruction', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='instruction_acknowledgments', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='technicalinstructioninstance',
            name='evaluation_session',
            field=models.ForeignKey(help_text='Evaluation session this instruction applies to', on_delete=django.db.models.deletion.CASCADE, related_name='instruction_instances', to='evaluation.evaluationsession'),
        ),
        migrations.AddField(
            model_name='technicalinstructioninstance',
            name='override_approved_by',
            field=models.ForeignKey(blank=True, help_text='User who approved the override (if required)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='instruction_override_approvals', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='technicalinstructioninstance',
            name='override_by',
            field=models.ForeignKey(blank=True, help_text='User who overrode the instruction', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='instruction_overrides', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='technicalinstructioninstance',
            name='related_cells',
            field=models.ManyToManyField(blank=True, help_text='Specific cells that triggered this instruction', related_name='instruction_instances', to='evaluation.evaluationcell'),
        ),
        migrations.AddIndex(
            model_name='technicalinstructiontemplate',
            index=models.Index(fields=['scope', 'stage', 'is_active'], name='ix_ti_template_scope_stage'),
        ),
        migrations.AddIndex(
            model_name='technicalinstructiontemplate',
            index=models.Index(fields=['severity', 'is_active'], name='ix_ti_template_severity'),
        ),
        migrations.AddIndex(
            model_name='technicalinstructiontemplate',
            index=models.Index(fields=['code'], name='ix_ti_template_code'),
        ),
        migrations.AddIndex(
            model_name='technicalinstructiontemplate',
            index=models.Index(fields=['-priority'], name='ix_ti_template_priority'),
        ),
        migrations.AddField(
            model_name='technicalinstructioninstance',
            name='template',
            field=models.ForeignKey(help_text='Template this instruction was generated from', on_delete=django.db.models.deletion.PROTECT, related_name='instances', to='evaluation.technicalinstructiontemplate'),
        ),
        migrations.AddField(
            model_name='threadinspection',
            name='evaluation_session',
            field=models.ForeignKey(help_text='Parent evaluation session', on_delete=django.db.models.deletion.CASCADE, related_name='thread_inspections', to='evaluation.evaluationsession'),
        ),
        migrations.AddField(
            model_name='threadinspection',
            name='inspected_by',
            field=models.ForeignKey(help_text='Employee who performed the inspection', on_delete=django.db.models.deletion.PROTECT, related_name='thread_inspections_conducted', to='hr.hremployee'),
        ),
        migrations.AddField(
            model_name='evaluationchangelog',
            name='thread_inspection',
            field=models.ForeignKey(blank=True, help_text='Thread inspection that was changed (if applicable)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='change_logs', to='evaluation.threadinspection'),
        ),
        migrations.AddIndex(
            model_name='evaluationsession',
            index=models.Index(fields=['serial_unit', '-created_at'], name='ix_eval_serial_created'),
        ),
        migrations.AddIndex(
            model_name='evaluationsession',
            index=models.Index(fields=['status', '-created_at'], name='ix_eval_status_created'),
        ),
        migrations.AddIndex(
            model_name='evaluationsession',
            index=models.Index(fields=['context', 'status'], name='ix_eval_context_status'),
        ),
        migrations.AddIndex(
            model_name='evaluationsession',
            index=models.Index(fields=['evaluator', '-created_at'], name='ix_eval_evaluator'),
        ),
        migrations.AddIndex(
            model_name='evaluationsession',
            index=models.Index(fields=['customer_name', 'status'], name='ix_eval_customer_status'),
        ),
        migrations.AddIndex(
            model_name='evaluationsession',
            index=models.Index(fields=['is_last_known_state', 'serial_unit'], name='ix_eval_last_state'),
        ),
        migrations.AddIndex(
            model_name='evaluationsession',
            index=models.Index(fields=['job_card'], name='ix_eval_job_card'),
        ),
        migrations.AddIndex(
            model_name='evaluationsession',
            index=models.Index(fields=['batch_order'], name='ix_eval_batch'),
        ),
        migrations.AddConstraint(
            model_name='evaluationsession',
            constraint=models.CheckConstraint(condition=models.Q(('total_cells__gte', 0)), name='ck_eval_total_cells_non_negative'),
        ),
        migrations.AddConstraint(
            model_name='evaluationsession',
            constraint=models.CheckConstraint(condition=models.Q(('replace_count__gte', 0)), name='ck_eval_replace_count_non_negative'),
        ),
        migrations.AddIndex(
            model_name='evaluationcell',
            index=models.Index(fields=['evaluation_session', 'blade_number', 'section'], name='ix_eval_cell_session_blade'),
        ),
        migrations.AddIndex(
            model_name='evaluationcell',
            index=models.Index(fields=['evaluation_session', 'cutter_code'], name='ix_eval_cell_session_code'),
        ),
        migrations.AddIndex(
            model_name='evaluationcell',
            index=models.Index(fields=['cutter_item'], name='ix_eval_cell_cutter_item'),
        ),
        migrations.AddIndex(
            model_name='evaluationcell',
            index=models.Index(fields=['section', 'is_primary'], name='ix_eval_cell_section_primary'),
        ),
        migrations.AddConstraint(
            model_name='evaluationcell',
            constraint=models.UniqueConstraint(fields=('evaluation_session', 'blade_number', 'section', 'position_index', 'is_primary'), name='uq_eval_cell_position'),
        ),
        migrations.AddConstraint(
            model_name='evaluationcell',
            constraint=models.CheckConstraint(condition=models.Q(('blade_number__gte', 1)), name='ck_eval_cell_blade_positive'),
        ),
        migrations.AddConstraint(
            model_name='evaluationcell',
            constraint=models.CheckConstraint(condition=models.Q(('position_index__gte', 1)), name='ck_eval_cell_position_positive'),
        ),
        migrations.AddIndex(
            model_name='ndtinspection',
            index=models.Index(fields=['evaluation_session', 'method'], name='ix_ndt_insp_session_method'),
        ),
        migrations.AddIndex(
            model_name='ndtinspection',
            index=models.Index(fields=['method', 'result'], name='ix_ndt_insp_method_result'),
        ),
        migrations.AddIndex(
            model_name='ndtinspection',
            index=models.Index(fields=['inspector', '-inspected_at'], name='ix_ndt_insp_inspector'),
        ),
        migrations.AddIndex(
            model_name='ndtinspection',
            index=models.Index(fields=['result', '-inspected_at'], name='ix_ndt_insp_result_date'),
        ),
        migrations.AddIndex(
            model_name='requirementinstance',
            index=models.Index(fields=['evaluation_session', 'status'], name='ix_req_inst_session_status'),
        ),
        migrations.AddIndex(
            model_name='requirementinstance',
            index=models.Index(fields=['status', '-created_at'], name='ix_req_inst_status_created'),
        ),
        migrations.AddIndex(
            model_name='requirementinstance',
            index=models.Index(fields=['template', 'status'], name='ix_req_inst_template_status'),
        ),
        migrations.AddIndex(
            model_name='requirementinstance',
            index=models.Index(fields=['due_at'], name='ix_req_inst_due_at'),
        ),
        migrations.AddConstraint(
            model_name='requirementinstance',
            constraint=models.UniqueConstraint(fields=('evaluation_session', 'template'), name='uq_req_inst_session_template'),
        ),
        migrations.AddIndex(
            model_name='technicalinstructioninstance',
            index=models.Index(fields=['evaluation_session', 'status'], name='ix_ti_inst_session_status'),
        ),
        migrations.AddIndex(
            model_name='technicalinstructioninstance',
            index=models.Index(fields=['evaluation_session', 'stage'], name='ix_ti_inst_session_stage'),
        ),
        migrations.AddIndex(
            model_name='technicalinstructioninstance',
            index=models.Index(fields=['status', 'severity'], name='ix_ti_inst_status_severity'),
        ),
        migrations.AddIndex(
            model_name='technicalinstructioninstance',
            index=models.Index(fields=['template', '-generated_at'], name='ix_ti_inst_template'),
        ),
        migrations.AddIndex(
            model_name='threadinspection',
            index=models.Index(fields=['evaluation_session', 'result'], name='ix_thread_insp_session_result'),
        ),
        migrations.AddIndex(
            model_name='threadinspection',
            index=models.Index(fields=['inspected_by', '-inspected_at'], name='ix_thread_insp_inspector'),
        ),
        migrations.AddIndex(
            model_name='threadinspection',
            index=models.Index(fields=['result', '-inspected_at'], name='ix_thread_insp_result_date'),
        ),
        migrations.AddIndex(
            model_name='evaluationchangelog',
            index=models.Index(fields=['evaluation_session', '-changed_at'], name='ix_eval_changelog_session'),
        ),
        migrations.AddIndex(
            model_name='evaluationchangelog',
            index=models.Index(fields=['changed_by', '-changed_at'], name='ix_eval_changelog_user'),
        ),
        migrations.AddIndex(
            model_name='evaluationchangelog',
            index=models.Index(fields=['change_stage', '-changed_at'], name='ix_eval_changelog_stage'),
        ),
        migrations.AddIndex(
            model_name='evaluationchangelog',
            index=models.Index(fields=['change_type', '-changed_at'], name='ix_eval_changelog_type'),
        ),
        migrations.AddIndex(
            model_name='evaluationchangelog',
            index=models.Index(fields=['evaluation_cell', '-changed_at'], name='ix_eval_changelog_cell'),
        ),
        migrations.AddIndex(
            model_name='evaluationchangelog',
            index=models.Index(fields=['field_changed', '-changed_at'], name='ix_eval_changelog_field'),
        ),
    ]
