{% extends "base.html" %}
{% load static %}

{% block title %}Parking Management - Floor Management System{% endblock %}

{% block extra_css %}
<style>
    .zone-card {
        border-radius: 12px;
        border: none;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        transition: all 0.3s;
    }
    .zone-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }
    .parking-spot {
        width: 100%;
        aspect-ratio: 1;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
        border: 2px solid transparent;
    }
    .parking-spot:hover {
        transform: scale(1.05);
        border-color: #0d6efd;
    }
    .spot-available {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
    }
    .spot-assigned {
        background: linear-gradient(135deg, #cfe2ff 0%, #b6d4fe 100%);
        color: #084298;
    }
    .spot-reserved {
        background: linear-gradient(135deg, #fff3cd 0%, #ffecb5 100%);
        color: #664d03;
    }
    .spot-maintenance {
        background: linear-gradient(135deg, #f8d7da 0%, #f1aeb5 100%);
        color: #842029;
    }
    .spot-disabled {
        background: #e9ecef;
        color: #6c757d;
        opacity: 0.6;
    }
    .zone-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 12px 12px 0 0;
        padding: 16px;
    }
    .occupancy-bar {
        height: 8px;
        border-radius: 4px;
        overflow: hidden;
        background: rgba(255,255,255,0.3);
    }
    .occupancy-fill {
        height: 100%;
        background: white;
        transition: width 0.3s;
    }
    .filter-section {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 24px;
    }
    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: 8px;
        background: white;
        border: 1px solid #e9ecef;
    }
    .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 4px;
    }
    .stats-card {
        border-radius: 12px;
        border: none;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="container-fluid mt-3">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'core:home' %}">Home</a></li>
            <li class="breadcrumb-item"><a href="#">HR Assets</a></li>
            <li class="breadcrumb-item active" aria-current="page">Parking Management</li>
        </ol>
    </nav>
</div>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-1">Parking Management</h2>
            <p class="text-muted mb-0">Monitor and manage parking spot assignments</p>
        </div>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#assignSpotModal">
            <i class="bi bi-plus-circle me-2"></i>Assign Parking Spot
        </button>
    </div>

    <!-- Statistics Cards -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card stats-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted mb-1 small">Total Spots</p>
                            <h3 class="fw-bold mb-0">120</h3>
                        </div>
                        <div class="stats-icon bg-primary bg-opacity-10 text-primary" style="width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                            <i class="bi bi-p-square-fill"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stats-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted mb-1 small">Available</p>
                            <h3 class="fw-bold mb-0 text-success">28</h3>
                            <small class="text-success">23.3%</small>
                        </div>
                        <div class="stats-icon bg-success bg-opacity-10 text-success" style="width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                            <i class="bi bi-check-circle-fill"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stats-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted mb-1 small">Assigned</p>
                            <h3 class="fw-bold mb-0 text-info">82</h3>
                            <small class="text-info">68.3%</small>
                        </div>
                        <div class="stats-icon bg-info bg-opacity-10 text-info" style="width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                            <i class="bi bi-person-fill"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stats-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted mb-1 small">Reserved</p>
                            <h3 class="fw-bold mb-0 text-warning">10</h3>
                            <small class="text-warning">8.3%</small>
                        </div>
                        <div class="stats-icon bg-warning bg-opacity-10 text-warning" style="width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                            <i class="bi bi-bookmark-fill"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
        <div class="row g-3 align-items-end">
            <div class="col-md-3">
                <label class="form-label small fw-semibold">Search</label>
                <input type="text" class="form-control" placeholder="Search by employee or spot number...">
            </div>
            <div class="col-md-2">
                <label class="form-label small fw-semibold">Zone</label>
                <select class="form-select">
                    <option value="">All Zones</option>
                    <option>Zone A - Main Building</option>
                    <option>Zone B - Warehouse</option>
                    <option>Zone C - Executive</option>
                    <option>Zone D - Visitor</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label small fw-semibold">Spot Type</label>
                <select class="form-select">
                    <option value="">All Types</option>
                    <option>Standard</option>
                    <option>Compact</option>
                    <option>Handicap</option>
                    <option>EV Charging</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label small fw-semibold">Status</label>
                <select class="form-select">
                    <option value="">All Status</option>
                    <option>Available</option>
                    <option>Assigned</option>
                    <option>Reserved</option>
                    <option>Maintenance</option>
                </select>
            </div>
            <div class="col-md-3">
                <button class="btn btn-primary w-100">
                    <i class="bi bi-funnel me-2"></i>Apply Filters
                </button>
            </div>
        </div>
    </div>

    <!-- Legend -->
    <div class="d-flex flex-wrap gap-2 mb-4">
        <div class="legend-item">
            <div class="legend-color spot-available"></div>
            <span class="small fw-semibold">Available</span>
        </div>
        <div class="legend-item">
            <div class="legend-color spot-assigned"></div>
            <span class="small fw-semibold">Assigned</span>
        </div>
        <div class="legend-item">
            <div class="legend-color spot-reserved"></div>
            <span class="small fw-semibold">Reserved</span>
        </div>
        <div class="legend-item">
            <div class="legend-color spot-maintenance"></div>
            <span class="small fw-semibold">Maintenance</span>
        </div>
        <div class="legend-item">
            <div class="legend-color spot-disabled"></div>
            <span class="small fw-semibold">Disabled</span>
        </div>
    </div>

    <!-- Parking Zones -->
    <div class="row g-4">
        <!-- Zone A -->
        <div class="col-lg-6">
            <div class="card zone-card">
                <div class="zone-header">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0"><i class="bi bi-building me-2"></i>Zone A - Main Building</h5>
                        <span class="badge bg-white text-dark">40 spots</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <small>Occupancy: 30/40 (75%)</small>
                    </div>
                    <div class="occupancy-bar">
                        <div class="occupancy-fill" style="width: 75%"></div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row g-2">
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="A-01: John Smith">A-01</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="A-02: Jane Doe">A-02</div></div>
                        <div class="col-3"><div class="parking-spot spot-available" data-bs-toggle="tooltip" title="A-03: Available">A-03</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="A-04: Mike Johnson">A-04</div></div>
                        <div class="col-3"><div class="parking-spot spot-reserved" data-bs-toggle="tooltip" title="A-05: Reserved for VIP">A-05</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="A-06: Sarah Wilson">A-06</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="A-07: Tom Brown">A-07</div></div>
                        <div class="col-3"><div class="parking-spot spot-available" data-bs-toggle="tooltip" title="A-08: Available">A-08</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="A-09: Lisa Davis">A-09</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="A-10: Robert Lee">A-10</div></div>
                        <div class="col-3"><div class="parking-spot spot-maintenance" data-bs-toggle="tooltip" title="A-11: Under Maintenance">A-11</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="A-12: Emily Chen">A-12</div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Zone B -->
        <div class="col-lg-6">
            <div class="card zone-card">
                <div class="zone-header">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0"><i class="bi bi-truck me-2"></i>Zone B - Warehouse</h5>
                        <span class="badge bg-white text-dark">30 spots</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <small>Occupancy: 22/30 (73%)</small>
                    </div>
                    <div class="occupancy-bar">
                        <div class="occupancy-fill" style="width: 73%"></div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row g-2">
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="B-01: Delivery Van">B-01</div></div>
                        <div class="col-3"><div class="parking-spot spot-available" data-bs-toggle="tooltip" title="B-02: Available">B-02</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="B-03: Cargo Truck">B-03</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="B-04: Service Vehicle">B-04</div></div>
                        <div class="col-3"><div class="parking-spot spot-available" data-bs-toggle="tooltip" title="B-05: Available">B-05</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="B-06: Forklift Storage">B-06</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="B-07: Loading Truck">B-07</div></div>
                        <div class="col-3"><div class="parking-spot spot-available" data-bs-toggle="tooltip" title="B-08: Available">B-08</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="B-09: Company Van">B-09</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="B-10: Utility Vehicle">B-10</div></div>
                        <div class="col-3"><div class="parking-spot spot-available" data-bs-toggle="tooltip" title="B-11: Available">B-11</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="B-12: Pickup Truck">B-12</div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Zone C -->
        <div class="col-lg-6">
            <div class="card zone-card">
                <div class="zone-header">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0"><i class="bi bi-star-fill me-2"></i>Zone C - Executive</h5>
                        <span class="badge bg-white text-dark">20 spots</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <small>Occupancy: 18/20 (90%)</small>
                    </div>
                    <div class="occupancy-bar">
                        <div class="occupancy-fill" style="width: 90%"></div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row g-2">
                        <div class="col-3"><div class="parking-spot spot-reserved" data-bs-toggle="tooltip" title="C-01: CEO Reserved">C-01</div></div>
                        <div class="col-3"><div class="parking-spot spot-reserved" data-bs-toggle="tooltip" title="C-02: CFO Reserved">C-02</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="C-03: VP Operations">C-03</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="C-04: VP Sales">C-04</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="C-05: Director HR">C-05</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="C-06: Director IT">C-06</div></div>
                        <div class="col-3"><div class="parking-spot spot-available" data-bs-toggle="tooltip" title="C-07: Available">C-07</div></div>
                        <div class="col-3"><div class="parking-spot spot-available" data-bs-toggle="tooltip" title="C-08: Available">C-08</div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Zone D -->
        <div class="col-lg-6">
            <div class="card zone-card">
                <div class="zone-header">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0"><i class="bi bi-person-badge me-2"></i>Zone D - Visitor</h5>
                        <span class="badge bg-white text-dark">30 spots</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <small>Occupancy: 12/30 (40%)</small>
                    </div>
                    <div class="occupancy-bar">
                        <div class="occupancy-fill" style="width: 40%"></div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row g-2">
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="D-01: Visitor">D-01</div></div>
                        <div class="col-3"><div class="parking-spot spot-available" data-bs-toggle="tooltip" title="D-02: Available">D-02</div></div>
                        <div class="col-3"><div class="parking-spot spot-available" data-bs-toggle="tooltip" title="D-03: Available">D-03</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="D-04: Visitor">D-04</div></div>
                        <div class="col-3"><div class="parking-spot spot-available" data-bs-toggle="tooltip" title="D-05: Available">D-05</div></div>
                        <div class="col-3"><div class="parking-spot spot-available" data-bs-toggle="tooltip" title="D-06: Available">D-06</div></div>
                        <div class="col-3"><div class="parking-spot spot-assigned" data-bs-toggle="tooltip" title="D-07: Visitor">D-07</div></div>
                        <div class="col-3"><div class="parking-spot spot-available" data-bs-toggle="tooltip" title="D-08: Available">D-08</div></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Assign Spot Modal -->
<div class="modal fade" id="assignSpotModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Assign Parking Spot</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label class="form-label">Employee</label>
                        <select class="form-select">
                            <option>Select employee...</option>
                            <option>John Smith</option>
                            <option>Jane Doe</option>
                            <option>Mike Johnson</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Zone</label>
                        <select class="form-select">
                            <option>Zone A - Main Building</option>
                            <option>Zone B - Warehouse</option>
                            <option>Zone C - Executive</option>
                            <option>Zone D - Visitor</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Spot Number</label>
                        <select class="form-select">
                            <option>A-03 (Available)</option>
                            <option>A-08 (Available)</option>
                            <option>B-02 (Available)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Vehicle Plate</label>
                        <input type="text" class="form-control" placeholder="ABC-1234">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Assignment Type</label>
                        <select class="form-select">
                            <option>Permanent</option>
                            <option>Temporary</option>
                            <option>Reserved</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Assign Spot</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize tooltips
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });

    // Parking spot click handler
    document.querySelectorAll('.parking-spot').forEach(spot => {
        spot.addEventListener('click', function() {
            const spotNumber = this.textContent;
            const status = this.className.includes('available') ? 'Available' :
                          this.className.includes('assigned') ? 'Assigned' :
                          this.className.includes('reserved') ? 'Reserved' : 'Maintenance';

            if (status === 'Available') {
                const modal = new bootstrap.Modal(document.getElementById('assignSpotModal'));
                modal.show();
            }
        });
    });
});
</script>
{% endblock %}
