{% extends "base.html" %}
{% load static %}

{% block title %}HR & Administration - Floor Management System{% endblock %}

{% block extra_css %}
<style>
    .dashboard-card {
        transition: all 0.25s ease;
        border: 1px solid #e9ecef;
        background: white;
        min-height: 180px;
        border-radius: 12px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
    }

    .dashboard-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
        border-color: #0d6efd;
    }

    .card-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
        margin-bottom: 0.75rem;
    }

    .stat-card {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 12px;
        padding: 1rem 1.25rem;
        transition: all 0.25s ease;
        height: 100%;
    }

    .stat-card:hover {
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }

    .stat-number {
        font-size: 1.8rem;
        font-weight: 700;
        color: #212529;
    }

    .stat-label {
        font-size: 0.9rem;
        color: #495057;
        margin-top: 0.25rem;
    }

    .section-title {
        color: #212529;
        font-weight: 700;
        margin-bottom: 0.75rem;
        font-size: 1.25rem;
    }

    .pill-badge {
        font-size: 0.8rem;
        border-radius: 50px;
        padding: 0.25rem 0.6rem;
    }
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="container-fluid pt-3 pb-2 border-bottom bg-light">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="{% url 'core:home' %}">Dashboard</a></li>
            <li class="breadcrumb-item active">HR & Administration</li>
        </ol>
    </nav>
</div>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                <div>
                    <h2 class="mb-2" style="color: #212529; font-weight: 700;">
                        <i class="bi bi-people-fill text-primary me-2"></i>
                        HR & Administration Control Center
                    </h2>
                    <p class="mb-0" style="color: #495057;">
                        Clear, actionable overview of employees, services, and compliance for HR teams.
                    </p>
                </div>
                <div class="d-flex gap-2 flex-wrap">
                    <a href="{% url 'hr:employee_portal' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-person-lines-fill me-2"></i>Employee Portal
                    </a>
                    <a href="{% url 'hr:employee_wizard_start' %}" class="btn btn-primary">
                        <i class="bi bi-person-plus me-2"></i>New Employee
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Summary Statistics -->
    <div class="row g-3 mb-4">
        <div class="col-lg-3 col-md-6">
            <div class="stat-card">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <div class="stat-number text-primary">{{ summary.total_employees|default:"0" }}</div>
                        <div class="stat-label">Total Employees</div>
                    </div>
                    <i class="bi bi-people-fill text-primary fs-3"></i>
                </div>
                <div class="mt-3 text-success fw-semibold">
                    Active: {{ summary.active_employees|default:"0" }} | On Leave: {{ summary.on_leave|default:"0" }}
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="stat-card">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <div class="stat-number text-success">{{ org.departments|default:"0" }}</div>
                        <div class="stat-label">Departments</div>
                    </div>
                    <i class="bi bi-diagram-3 text-success fs-3"></i>
                </div>
                <div class="mt-3 text-muted">Positions: {{ org.positions|default:"0" }} | Open: {{ org.open_positions|default:"0" }}</div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="stat-card">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <div class="stat-number text-warning">{{ compliance.expiring_documents_count|default:"0" }}</div>
                        <div class="stat-label">Expiring Docs (30 days)</div>
                    </div>
                    <i class="bi bi-file-earmark-text text-warning fs-3"></i>
                </div>
                <div class="mt-3 text-danger fw-semibold">Expired: {{ compliance.expired_documents_count|default:"0" }}</div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="stat-card">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <div class="stat-number text-info">{{ attendance.today_records|default:"0" }}</div>
                        <div class="stat-label">Today's Attendance</div>
                    </div>
                    <i class="bi bi-calendar-check text-info fs-3"></i>
                </div>
                <div class="mt-3 text-primary">Pending OT Approvals: {{ attendance.overtime_pending|default:"0" }}</div>
            </div>
        </div>
    </div>

    <!-- HR Service Cards -->
    <div class="row g-3 mb-4">
        <div class="col-lg-3 col-md-6">
            <div class="card dashboard-card h-100">
                <div class="card-body p-3">
                    <div class="card-icon bg-primary text-white"><i class="bi bi-person-plus-fill"></i></div>
                    <h6 class="card-title mb-2">People & Onboarding</h6>
                    <p class="text-muted small mb-3">Create and manage people records, onboarding, and assignments.</p>
                    <div class="d-grid gap-2">
                        <a href="{% url 'hr:employee_wizard_start' %}" class="btn btn-primary btn-sm">Start Onboarding</a>
                        <a href="{% url 'hr:people_list' %}" class="btn btn-outline-primary btn-sm">People Directory</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card dashboard-card h-100">
                <div class="card-body p-3">
                    <div class="card-icon bg-success text-white"><i class="bi bi-people"></i></div>
                    <h6 class="card-title mb-2">Employees & Teams</h6>
                    <p class="text-muted small mb-3">Monitor headcount, organization charts, departments, and roles.</p>
                    <div class="d-grid gap-2">
                        <a href="{% url 'hr:employee_list' %}" class="btn btn-outline-success btn-sm">Employee List</a>
                        <a href="{% url 'hr:department_list' %}" class="btn btn-outline-success btn-sm">Departments & Positions</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card dashboard-card h-100">
                <div class="card-body p-3">
                    <div class="card-icon bg-warning text-white"><i class="bi bi-calendar2-week"></i></div>
                    <h6 class="card-title mb-2">Attendance & Leave</h6>
                    <p class="text-muted small mb-3">Track attendance, overtime approvals, and leave calendars.</p>
                    <div class="d-grid gap-2">
                        <a href="{% url 'hr:attendance_dashboard' %}" class="btn btn-outline-warning btn-sm">Attendance</a>
                        <a href="{% url 'hr:leave_calendar' %}" class="btn btn-outline-warning btn-sm">Leave Calendar</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card dashboard-card h-100">
                <div class="card-body p-3">
                    <div class="card-icon bg-info text-white"><i class="bi bi-file-earmark-check"></i></div>
                    <h6 class="card-title mb-2">Compliance & Documents</h6>
                    <p class="text-muted small mb-3">Renew expiring documents, verify uploads, and print records.</p>
                    <div class="d-grid gap-2">
                        <a href="{% url 'hr:hr_documents_dashboard' %}" class="btn btn-outline-info btn-sm">HR Documents</a>
                        <a href="{% url 'hr:hr_expiry_dashboard' %}" class="btn btn-outline-info btn-sm">Expiry Monitor</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics & Alerts -->
    <div class="row g-4 mb-4">
        <div class="col-xl-6">
            <div class="card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="section-title mb-0">HR Signals</h5>
                        <span class="badge bg-light text-dark pill-badge">Live tasks</span>
                    </div>
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="stat-card h-100">
                                <div class="stat-number text-danger">{{ pending_leave_requests|length }}</div>
                                <div class="stat-label">Leave Requests pending decision</div>
                                <p class="mt-2 mb-0 text-muted small">Review submissions awaiting approval or scheduling.</p>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-card h-100">
                                <div class="stat-number text-warning">{{ compliance.contracts_due_soon|default:"0" }}</div>
                                <div class="stat-label">Contracts expiring in 30 days</div>
                                <p class="mt-2 mb-0 text-muted small">Coordinate renewals or offboarding early.</p>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-card h-100">
                                <div class="stat-number text-primary">{{ summary.new_hires_30|default:"0" }}</div>
                                <div class="stat-label">New hires this month</div>
                                <p class="mt-2 mb-0 text-muted small">Ensure equipment, ID cards, and induction are ready.</p>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-card h-100">
                                <div class="stat-number text-success">{{ org.unassigned|default:"0" }}</div>
                                <div class="stat-label">Employees without positions</div>
                                <p class="mt-2 mb-0 text-muted small">Assign roles to close gaps and clarify reporting lines.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-6">
            <div class="card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="section-title mb-0">Notifications & Deadlines</h5>
                        <span class="badge bg-danger pill-badge">Action required</span>
                    </div>
                    <div class="list-group list-group-flush">
                        <div class="list-group-item bg-light fw-semibold">Expiring documents</div>
                        {% if expiring_documents %}
                            {% for doc in expiring_documents %}
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="fw-semibold">{{ doc.title }}</div>
                                        <small class="text-muted">{{ doc.get_document_type_display }} • Expires {{ doc.expiry_date }}</small>
                                    </div>
                                    <span class="badge bg-warning text-dark pill-badge">Renew</span>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="list-group-item text-muted">No upcoming document expiries.</div>
                        {% endif %}

                        <div class="list-group-item bg-light fw-semibold">Pending leave decisions</div>
                        {% if pending_leave_requests %}
                            {% for leave in pending_leave_requests %}
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="fw-semibold">{{ leave.employee.person.get_full_name_en|default:leave.employee.employee_no }}</div>
                                        <small class="text-muted">{{ leave.leave_policy.name }} • {{ leave.start_date }} to {{ leave.end_date }}</small>
                                    </div>
                                    <span class="badge bg-primary pill-badge">Review</span>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="list-group-item text-muted">No leave approvals waiting.</div>
                        {% endif %}

                        <div class="list-group-item bg-light fw-semibold">Overtime approvals</div>
                        {% if pending_overtime_requests %}
                            {% for overtime in pending_overtime_requests %}
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="fw-semibold">{{ overtime.employee.person.get_full_name_en|default:overtime.employee.employee_no }}</div>
                                        <small class="text-muted">Requested {{ overtime.created_at|date:"Y-m-d" }} • {{ overtime.planned_hours }} hours</small>
                                    </div>
                                    <span class="badge bg-danger pill-badge">Approve</span>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="list-group-item text-muted">No overtime requests pending.</div>
                        {% endif %}

                        <div class="list-group-item bg-light fw-semibold">Contracts ending soon</div>
                        {% if contracts_due_soon %}
                            {% for contract in contracts_due_soon %}
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="fw-semibold">{{ contract.person.get_full_name_en|default:contract.employee_no }}</div>
                                        <small class="text-muted">{{ contract.department.name|default:"No department" }} • Ends {{ contract.contract_end_date }}</small>
                                    </div>
                                    <span class="badge bg-light text-secondary pill-badge border">Renewal check</span>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="list-group-item text-muted">No contracts ending in the next 30 days.</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Talent & Assets -->
    <div class="row g-4">
        <div class="col-xl-8">
            <div class="card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="section-title mb-0">Training & Capability</h5>
                        <a href="{% url 'hr:training_program_list' %}" class="btn btn-sm btn-outline-primary">Training Catalog</a>
                    </div>
                    <div class="row g-3">
                        {% if upcoming_trainings %}
                            {% for session in upcoming_trainings %}
                                <div class="col-md-6">
                                    <div class="stat-card h-100">
                                        <div class="fw-semibold">{{ session.program.name }}</div>
                                        <div class="text-muted small">Session starts {{ session.start_date }}</div>
                                        <div class="mt-2 text-primary">{{ session.location|default:"TBD" }}</div>
                                        <div class="mt-3 d-flex gap-2">
                                            <span class="badge bg-light text-dark pill-badge">Registered: {{ session.participant_count }}</span>
                                            <span class="badge bg-primary pill-badge">{{ session.program.get_training_type_display }}</span>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="col-12 text-muted">No upcoming training sessions scheduled.</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-4">
            <div class="card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="section-title mb-0">Open Positions</h5>
                        <span class="badge bg-light text-dark pill-badge">{{ org.open_positions|default:"0" }} roles</span>
                    </div>
                    <div class="list-group list-group-flush">
                        {% if open_positions %}
                            {% for position in open_positions %}
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="fw-semibold">{{ position.name }}</div>
                                        <small class="text-muted">{{ position.department.name|default:"No department" }}</small>
                                    </div>
                                    <a href="{% url 'hr:position_detail' position.pk %}" class="btn btn-sm btn-outline-secondary">View</a>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="list-group-item text-muted">All positions are filled.</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
