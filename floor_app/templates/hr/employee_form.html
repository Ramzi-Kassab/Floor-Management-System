{% extends "base.html" %}
{% load static %}

{% block title %}{{ title }} - HR Management{% endblock %}

{% block extra_css %}
<style>
    .form-section {
        background: white;
        border-radius: 12px;
        border: 1px solid #dee2e6;
        padding: 2rem;
        margin-bottom: 1.5rem;
    }

    .section-header {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #e9ecef;
    }

    .section-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        margin-right: 1rem;
    }

    .section-title {
        color: #212529;
        font-weight: 600;
        font-size: 1.25rem;
        margin: 0;
    }

    .section-subtitle {
        color: #6c757d;
        font-size: 0.875rem;
        margin: 0;
    }

    .form-label {
        color: #212529;
        font-weight: 500;
        margin-bottom: 0.5rem;
    }

    .form-control:focus,
    .form-select:focus {
        border-color: #198754;
        box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.15);
    }

    .invalid-feedback {
        font-size: 0.875rem;
    }

    .required-marker {
        color: #dc3545;
        font-weight: bold;
    }

    .help-text {
        font-size: 0.8125rem;
        color: #6c757d;
        margin-top: 0.25rem;
    }

    .employee-info-card {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        border: 1px solid #dee2e6;
        border-radius: 12px;
        padding: 1.5rem;
    }

    .employee-photo {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid #dee2e6;
    }

    .employee-photo-placeholder {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: #e9ecef;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6c757d;
        font-size: 2.5rem;
        border: 4px solid #dee2e6;
    }

    .readonly-field {
        background-color: #e9ecef;
        cursor: not-allowed;
    }
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="container-fluid pt-3 pb-2 border-bottom bg-light">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="{% url 'core:home' %}">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{% url 'hr:dashboard' %}">HR & Administration</a></li>
            <li class="breadcrumb-item"><a href="{% url 'hr:employee_list' %}">Employees</a></li>
            <li class="breadcrumb-item active">{{ title }}</li>
        </ol>
    </nav>
</div>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                <div>
                    <h2 class="mb-2" style="color: #212529; font-weight: 700;">
                        <i class="bi bi-person-gear text-success me-2"></i>
                        {{ title }}
                    </h2>
                    <p class="mb-0" style="color: #495057;">
                        Update employment information for {{ person.get_full_name_en }}
                    </p>
                </div>
                <div class="d-flex gap-2">
                    <a href="{% url 'hr:employee_list' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left me-2"></i>Back to List
                    </a>
                    <a href="{% url 'hr:employee_detail' employee.pk %}" class="btn btn-outline-info">
                        <i class="bi bi-eye me-2"></i>View Details
                    </a>
                </div>
            </div>
        </div>
    </div>

    <form method="post" novalidate>
        {% csrf_token %}

        <div class="row">
            <!-- Main Form Content -->
            <div class="col-lg-8">
                <!-- Employee Status Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon bg-success bg-opacity-10">
                            <i class="bi bi-person-badge text-success"></i>
                        </div>
                        <div>
                            <h5 class="section-title">Employee Status</h5>
                            <p class="section-subtitle">Basic employment information</p>
                        </div>
                    </div>

                    <div class="row g-3">
                        <!-- Hidden person field (read-only) -->
                        <input type="hidden" name="{{ form.person.name }}" value="{{ employee.person.id }}">

                        <div class="col-md-4">
                            <label for="id_employee_no" class="form-label">
                                Employee Number <span class="required-marker">*</span>
                            </label>
                            <input type="text"
                                   class="form-control {% if form.employee_no.errors %}is-invalid{% endif %}"
                                   id="id_employee_no"
                                   name="{{ form.employee_no.name }}"
                                   value="{{ form.employee_no.value|default:'' }}"
                                   placeholder="e.g., EMP001"
                                   required>
                            {% if form.employee_no.errors %}
                            <div class="invalid-feedback">{{ form.employee_no.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-4">
                            <label for="id_status" class="form-label">
                                Status <span class="required-marker">*</span>
                            </label>
                            <select class="form-select {% if form.status.errors %}is-invalid{% endif %}"
                                    id="id_status"
                                    name="{{ form.status.name }}"
                                    required>
                                <option value="ACTIVE" {% if form.status.value == 'ACTIVE' %}selected{% endif %}>Active</option>
                                <option value="ON_LEAVE" {% if form.status.value == 'ON_LEAVE' %}selected{% endif %}>On Leave</option>
                                <option value="SUSPENDED" {% if form.status.value == 'SUSPENDED' %}selected{% endif %}>Suspended</option>
                                <option value="TERMINATED" {% if form.status.value == 'TERMINATED' %}selected{% endif %}>Terminated</option>
                            </select>
                            {% if form.status.errors %}
                            <div class="invalid-feedback">{{ form.status.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-4">
                            <label for="id_contract_type" class="form-label">
                                Contract Type <span class="required-marker">*</span>
                            </label>
                            <select class="form-select {% if form.contract_type.errors %}is-invalid{% endif %}"
                                    id="id_contract_type"
                                    name="{{ form.contract_type.name }}"
                                    required>
                                <option value="PERMANENT" {% if form.contract_type.value == 'PERMANENT' %}selected{% endif %}>Permanent</option>
                                <option value="FIXED_TERM" {% if form.contract_type.value == 'FIXED_TERM' %}selected{% endif %}>Fixed Term</option>
                                <option value="TEMPORARY" {% if form.contract_type.value == 'TEMPORARY' %}selected{% endif %}>Temporary</option>
                                <option value="PART_TIME" {% if form.contract_type.value == 'PART_TIME' %}selected{% endif %}>Part-Time</option>
                                <option value="INTERN" {% if form.contract_type.value == 'INTERN' %}selected{% endif %}>Intern</option>
                                <option value="CONSULTANT" {% if form.contract_type.value == 'CONSULTANT' %}selected{% endif %}>Consultant</option>
                                <option value="CONTRACTOR" {% if form.contract_type.value == 'CONTRACTOR' %}selected{% endif %}>Contractor</option>
                            </select>
                            {% if form.contract_type.errors %}
                            <div class="invalid-feedback">{{ form.contract_type.errors|join:", " }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Job Assignment Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon bg-primary bg-opacity-10">
                            <i class="bi bi-briefcase text-primary"></i>
                        </div>
                        <div>
                            <h5 class="section-title">Job Assignment</h5>
                            <p class="section-subtitle">Position and department</p>
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="id_department" class="form-label">Department</label>
                            <select class="form-select {% if form.department.errors %}is-invalid{% endif %}"
                                    id="id_department"
                                    name="{{ form.department.name }}">
                                <option value="">Select Department</option>
                                {% for dept in departments %}
                                <option value="{{ dept.id }}" {% if form.department.value == dept.id %}selected{% endif %}>
                                    {{ dept.name }}
                                </option>
                                {% endfor %}
                            </select>
                            {% if form.department.errors %}
                            <div class="invalid-feedback">{{ form.department.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-6">
                            <label for="id_position" class="form-label">Position</label>
                            <select class="form-select {% if form.position.errors %}is-invalid{% endif %}"
                                    id="id_position"
                                    name="{{ form.position.name }}">
                                <option value="">Select Position</option>
                                {% for pos in positions %}
                                <option value="{{ pos.id }}" {% if form.position.value == pos.id %}selected{% endif %}>
                                    {{ pos.name }}
                                </option>
                                {% endfor %}
                            </select>
                            {% if form.position.errors %}
                            <div class="invalid-feedback">{{ form.position.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-6">
                            <label for="id_employment_category" class="form-label">Employment Category</label>
                            <select class="form-select {% if form.employment_category.errors %}is-invalid{% endif %}"
                                    id="id_employment_category"
                                    name="{{ form.employment_category.name }}">
                                <option value="">Select Category</option>
                                <option value="REGULAR" {% if form.employment_category.value == 'REGULAR' %}selected{% endif %}>Regular</option>
                                <option value="PROBATIONARY" {% if form.employment_category.value == 'PROBATIONARY' %}selected{% endif %}>Probationary</option>
                                <option value="SEASONAL" {% if form.employment_category.value == 'SEASONAL' %}selected{% endif %}>Seasonal</option>
                                <option value="PROJECT_BASED" {% if form.employment_category.value == 'PROJECT_BASED' %}selected{% endif %}>Project-Based</option>
                            </select>
                            {% if form.employment_category.errors %}
                            <div class="invalid-feedback">{{ form.employment_category.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-6">
                            <label for="id_employment_status" class="form-label">Employment Status</label>
                            <select class="form-select {% if form.employment_status.errors %}is-invalid{% endif %}"
                                    id="id_employment_status"
                                    name="{{ form.employment_status.name }}">
                                <option value="ACTIVE" {% if form.employment_status.value == 'ACTIVE' %}selected{% endif %}>Active</option>
                                <option value="ON_PROBATION" {% if form.employment_status.value == 'ON_PROBATION' %}selected{% endif %}>On Probation</option>
                                <option value="UNDER_NOTICE" {% if form.employment_status.value == 'UNDER_NOTICE' %}selected{% endif %}>Under Notice</option>
                            </select>
                            {% if form.employment_status.errors %}
                            <div class="invalid-feedback">{{ form.employment_status.errors|join:", " }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Contract Dates Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon bg-info bg-opacity-10">
                            <i class="bi bi-calendar-event text-info"></i>
                        </div>
                        <div>
                            <h5 class="section-title">Employment Dates</h5>
                            <p class="section-subtitle">Contract and employment timeline</p>
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="id_hire_date" class="form-label">Hire Date</label>
                            <input type="date"
                                   class="form-control {% if form.hire_date.errors %}is-invalid{% endif %}"
                                   id="id_hire_date"
                                   name="{{ form.hire_date.name }}"
                                   value="{{ form.hire_date.value|date:'Y-m-d' }}">
                            {% if form.hire_date.errors %}
                            <div class="invalid-feedback">{{ form.hire_date.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-4">
                            <label for="id_contract_start_date" class="form-label">Contract Start</label>
                            <input type="date"
                                   class="form-control {% if form.contract_start_date.errors %}is-invalid{% endif %}"
                                   id="id_contract_start_date"
                                   name="{{ form.contract_start_date.name }}"
                                   value="{{ form.contract_start_date.value|date:'Y-m-d' }}">
                            {% if form.contract_start_date.errors %}
                            <div class="invalid-feedback">{{ form.contract_start_date.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-4">
                            <label for="id_contract_end_date" class="form-label">Contract End</label>
                            <input type="date"
                                   class="form-control {% if form.contract_end_date.errors %}is-invalid{% endif %}"
                                   id="id_contract_end_date"
                                   name="{{ form.contract_end_date.name }}"
                                   value="{{ form.contract_end_date.value|date:'Y-m-d' }}">
                            {% if form.contract_end_date.errors %}
                            <div class="invalid-feedback">{{ form.contract_end_date.errors|join:", " }}</div>
                            {% endif %}
                            <div class="help-text">For fixed-term contracts only</div>
                        </div>

                        <div class="col-md-4">
                            <label for="id_probation_end_date" class="form-label">Probation End Date</label>
                            <input type="date"
                                   class="form-control {% if form.probation_end_date.errors %}is-invalid{% endif %}"
                                   id="id_probation_end_date"
                                   name="{{ form.probation_end_date.name }}"
                                   value="{{ form.probation_end_date.value|date:'Y-m-d' }}">
                            {% if form.probation_end_date.errors %}
                            <div class="invalid-feedback">{{ form.probation_end_date.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-4">
                            <label for="id_probation_status" class="form-label">Probation Status</label>
                            <select class="form-select {% if form.probation_status.errors %}is-invalid{% endif %}"
                                    id="id_probation_status"
                                    name="{{ form.probation_status.name }}">
                                <option value="">Select Status</option>
                                <option value="PENDING" {% if form.probation_status.value == 'PENDING' %}selected{% endif %}>Pending</option>
                                <option value="PASSED" {% if form.probation_status.value == 'PASSED' %}selected{% endif %}>Passed</option>
                                <option value="EXTENDED" {% if form.probation_status.value == 'EXTENDED' %}selected{% endif %}>Extended</option>
                                <option value="FAILED" {% if form.probation_status.value == 'FAILED' %}selected{% endif %}>Failed</option>
                            </select>
                            {% if form.probation_status.errors %}
                            <div class="invalid-feedback">{{ form.probation_status.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-4">
                            <label for="id_termination_date" class="form-label">Termination Date</label>
                            <input type="date"
                                   class="form-control {% if form.termination_date.errors %}is-invalid{% endif %}"
                                   id="id_termination_date"
                                   name="{{ form.termination_date.name }}"
                                   value="{{ form.termination_date.value|date:'Y-m-d' }}">
                            {% if form.termination_date.errors %}
                            <div class="invalid-feedback">{{ form.termination_date.errors|join:", " }}</div>
                            {% endif %}
                            <div class="help-text">If employee has left</div>
                        </div>
                    </div>
                </div>

                <!-- Compensation Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon" style="background: rgba(32, 201, 151, 0.1);">
                            <i class="bi bi-cash-stack" style="color: #20c997;"></i>
                        </div>
                        <div>
                            <h5 class="section-title">Compensation & Benefits</h5>
                            <p class="section-subtitle">Salary and benefits information</p>
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="id_salary_grade" class="form-label">Salary Grade</label>
                            <select class="form-select {% if form.salary_grade.errors %}is-invalid{% endif %}"
                                    id="id_salary_grade"
                                    name="{{ form.salary_grade.name }}">
                                <option value="">Select Grade</option>
                                <option value="GRADE_A" {% if form.salary_grade.value == 'GRADE_A' %}selected{% endif %}>Grade A</option>
                                <option value="GRADE_B" {% if form.salary_grade.value == 'GRADE_B' %}selected{% endif %}>Grade B</option>
                                <option value="GRADE_C" {% if form.salary_grade.value == 'GRADE_C' %}selected{% endif %}>Grade C</option>
                                <option value="GRADE_D" {% if form.salary_grade.value == 'GRADE_D' %}selected{% endif %}>Grade D</option>
                                <option value="GRADE_E" {% if form.salary_grade.value == 'GRADE_E' %}selected{% endif %}>Grade E</option>
                                <option value="EXECUTIVE" {% if form.salary_grade.value == 'EXECUTIVE' %}selected{% endif %}>Executive</option>
                            </select>
                            {% if form.salary_grade.errors %}
                            <div class="invalid-feedback">{{ form.salary_grade.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-4">
                            <label for="id_monthly_salary" class="form-label">Monthly Salary</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number"
                                       class="form-control {% if form.monthly_salary.errors %}is-invalid{% endif %}"
                                       id="id_monthly_salary"
                                       name="{{ form.monthly_salary.name }}"
                                       value="{{ form.monthly_salary.value|default:'' }}"
                                       step="0.01">
                            </div>
                            {% if form.monthly_salary.errors %}
                            <div class="invalid-feedback">{{ form.monthly_salary.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-4">
                            <label for="id_cost_center" class="form-label">Cost Center</label>
                            <input type="text"
                                   class="form-control {% if form.cost_center.errors %}is-invalid{% endif %}"
                                   id="id_cost_center"
                                   name="{{ form.cost_center.name }}"
                                   value="{{ form.cost_center.value|default:'' }}"
                                   placeholder="e.g., CC-001">
                            {% if form.cost_center.errors %}
                            <div class="invalid-feedback">{{ form.cost_center.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input"
                                       type="checkbox"
                                       id="id_benefits_eligible"
                                       name="{{ form.benefits_eligible.name }}"
                                       {% if form.benefits_eligible.value %}checked{% endif %}>
                                <label class="form-check-label" for="id_benefits_eligible" style="color: #495057;">
                                    Benefits Eligible
                                </label>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input"
                                       type="checkbox"
                                       id="id_overtime_eligible"
                                       name="{{ form.overtime_eligible.name }}"
                                       {% if form.overtime_eligible.value %}checked{% endif %}>
                                <label class="form-check-label" for="id_overtime_eligible" style="color: #495057;">
                                    Overtime Eligible
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Leave Entitlements Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon" style="background: rgba(253, 126, 20, 0.1);">
                            <i class="bi bi-calendar-check" style="color: #fd7e14;"></i>
                        </div>
                        <div>
                            <h5 class="section-title">Leave Entitlements</h5>
                            <p class="section-subtitle">Annual leave allocation</p>
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="id_annual_leave_days" class="form-label">Annual Leave (days)</label>
                            <input type="number"
                                   class="form-control {% if form.annual_leave_days.errors %}is-invalid{% endif %}"
                                   id="id_annual_leave_days"
                                   name="{{ form.annual_leave_days.name }}"
                                   value="{{ form.annual_leave_days.value|default:'21' }}"
                                   min="0">
                            {% if form.annual_leave_days.errors %}
                            <div class="invalid-feedback">{{ form.annual_leave_days.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-4">
                            <label for="id_sick_leave_days" class="form-label">Sick Leave (days)</label>
                            <input type="number"
                                   class="form-control {% if form.sick_leave_days.errors %}is-invalid{% endif %}"
                                   id="id_sick_leave_days"
                                   name="{{ form.sick_leave_days.name }}"
                                   value="{{ form.sick_leave_days.value|default:'30' }}"
                                   min="0">
                            {% if form.sick_leave_days.errors %}
                            <div class="invalid-feedback">{{ form.sick_leave_days.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-4">
                            <label for="id_special_leave_days" class="form-label">Special Leave (days)</label>
                            <input type="number"
                                   class="form-control {% if form.special_leave_days.errors %}is-invalid{% endif %}"
                                   id="id_special_leave_days"
                                   name="{{ form.special_leave_days.name }}"
                                   value="{{ form.special_leave_days.value|default:'5' }}"
                                   min="0">
                            {% if form.special_leave_days.errors %}
                            <div class="invalid-feedback">{{ form.special_leave_days.errors|join:", " }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Work Schedule Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon bg-secondary bg-opacity-10">
                            <i class="bi bi-clock text-secondary"></i>
                        </div>
                        <div>
                            <h5 class="section-title">Work Schedule</h5>
                            <p class="section-subtitle">Working hours and schedule</p>
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="id_work_days_per_week" class="form-label">Days Per Week</label>
                            <input type="number"
                                   class="form-control {% if form.work_days_per_week.errors %}is-invalid{% endif %}"
                                   id="id_work_days_per_week"
                                   name="{{ form.work_days_per_week.name }}"
                                   value="{{ form.work_days_per_week.value|default:'5' }}"
                                   min="1"
                                   max="7">
                            {% if form.work_days_per_week.errors %}
                            <div class="invalid-feedback">{{ form.work_days_per_week.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-4">
                            <label for="id_hours_per_week" class="form-label">Hours Per Week</label>
                            <input type="number"
                                   class="form-control {% if form.hours_per_week.errors %}is-invalid{% endif %}"
                                   id="id_hours_per_week"
                                   name="{{ form.hours_per_week.name }}"
                                   value="{{ form.hours_per_week.value|default:'40' }}"
                                   step="0.5"
                                   min="0">
                            {% if form.hours_per_week.errors %}
                            <div class="invalid-feedback">{{ form.hours_per_week.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-4">
                            <label for="id_shift_pattern" class="form-label">Shift Pattern</label>
                            <input type="text"
                                   class="form-control {% if form.shift_pattern.errors %}is-invalid{% endif %}"
                                   id="id_shift_pattern"
                                   name="{{ form.shift_pattern.name }}"
                                   value="{{ form.shift_pattern.value|default:'' }}"
                                   placeholder="e.g., Morning, Night">
                            {% if form.shift_pattern.errors %}
                            <div class="invalid-feedback">{{ form.shift_pattern.errors|join:", " }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Employee Info Card -->
                <div class="employee-info-card mb-4">
                    <div class="text-center mb-3">
                        {% if person.photo %}
                        <img src="{{ person.photo.url }}" alt="{{ person.get_full_name_en }}" class="employee-photo">
                        {% else %}
                        <div class="employee-photo-placeholder mx-auto">
                            <i class="bi bi-person"></i>
                        </div>
                        {% endif %}
                    </div>

                    <h5 class="text-center mb-1" style="color: #212529; font-weight: 600;">
                        {{ person.get_full_name_en }}
                    </h5>
                    <p class="text-center mb-3" style="color: #6c757d;">
                        {{ employee.employee_no }}
                    </p>

                    <div class="list-group list-group-flush">
                        <div class="list-group-item bg-transparent px-0">
                            <small style="color: #6c757d;">National ID</small>
                            <div style="color: #212529; font-weight: 500;">{{ person.national_id|default:"Not provided" }}</div>
                        </div>
                        <div class="list-group-item bg-transparent px-0">
                            <small style="color: #6c757d;">Date of Birth</small>
                            <div style="color: #212529; font-weight: 500;">{{ person.date_of_birth|date:"Y-m-d"|default:"Not provided" }}</div>
                        </div>
                        <div class="list-group-item bg-transparent px-0">
                            <small style="color: #6c757d;">Nationality</small>
                            <div style="color: #212529; font-weight: 500;">{{ person.primary_nationality_iso2|default:"Not provided" }}</div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <a href="{% url 'hr:person_edit' person.id %}" class="btn btn-outline-primary w-100">
                            <i class="bi bi-pencil me-2"></i>Edit Personal Info
                        </a>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon bg-success bg-opacity-10">
                            <i class="bi bi-check2-square text-success"></i>
                        </div>
                        <div>
                            <h5 class="section-title">Actions</h5>
                            <p class="section-subtitle">Save or cancel changes</p>
                        </div>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-success btn-lg text-white">
                            <i class="bi bi-check-circle me-2"></i>Save Changes
                        </button>
                        <a href="{% url 'hr:employee_list' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle me-2"></i>Cancel
                        </a>
                        <a href="{% url 'hr:employee_detail' employee.pk %}" class="btn btn-outline-info">
                            <i class="bi bi-eye me-2"></i>View Details
                        </a>
                    </div>
                </div>

                <!-- Help Card -->
                <div class="card shadow-sm" style="border-left: 4px solid #20c997;">
                    <div class="card-body p-3">
                        <h6 class="mb-2" style="color: #212529; font-weight: 600;">
                            <i class="bi bi-info-circle me-2"></i>Important Notes
                        </h6>
                        <ul class="mb-0 ps-3" style="color: #495057; font-size: 0.875rem;">
                            <li>Changes are saved immediately when you click "Save Changes"</li>
                            <li>Contract end date is only required for fixed-term contracts</li>
                            <li>To update personal information, use the "Edit Personal Info" button above</li>
                            <li>Leave entitlements are reset at the start of each year</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');

    // Real-time validation feedback
    const inputs = form.querySelectorAll('input, select');
    inputs.forEach(function(input) {
        input.addEventListener('change', function() {
            if (this.value) {
                this.classList.remove('is-invalid');
            }
        });
    });

    // Contract type change handler
    const contractType = document.getElementById('id_contract_type');
    const contractEndDate = document.getElementById('id_contract_end_date');

    if (contractType && contractEndDate) {
        contractType.addEventListener('change', function() {
            if (this.value === 'FIXED_TERM' || this.value === 'TEMPORARY') {
                contractEndDate.setAttribute('required', 'required');
                contractEndDate.parentElement.querySelector('.form-label').innerHTML =
                    'Contract End <span class="required-marker">*</span>';
            } else {
                contractEndDate.removeAttribute('required');
                contractEndDate.parentElement.querySelector('.form-label').textContent = 'Contract End';
            }
        });
    }
});
</script>
{% endblock %}
